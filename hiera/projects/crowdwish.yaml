---
classes:
    - apache
    - php
    - postgresql

user:
    crowdwish:
        ensure: present
        require: Class[zsh]
        managehome: true
        shell: /bin/zsh


file:
    crowdwish_public_html:
        ensure: directory
        require: User[crowdwish]
        path: /home/crowdwish/public_html/
        owner: crowdwish
        group: crowdwish

    crowdwish_logs:
        ensure: directory
        require: User[crowdwish]
        path: /home/crowdwish/logs/
        owner: crowdwish
        group: crowdwish

    crowdwish_ssh:
        ensure: directory
        require: User[crowdwish]
        path: /home/crowdwish/.ssh/


ssh::known_host:
    crowdwish_gitlab1:
        require: User[crowdwish]
        fingerprint: '|1|jFMAjbKXsCo+bcUYuaFuaRPSTfw=|NO2jCgvGuWcrOgNm7m2es5J6hsE= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMXD4lrkJ2LfwypuAsGF9fNeAi8I4vO+Am2AH3/IHz4eIiIoA91ikeF4qfLFKECBBn1VIjRt4uGdhDK4LqVirkM='
        user: crowdwish
        owner: crowdwish
        group: crowdwish

    crowdwish_gitlab2:
        require: User[crowdwish]
        fingerprint: '|1|AaYdwoVDMGmRMi/DjHMKBIZXNwI=|QKjF9kDTQtDubziPlQgiFeWd8Pw= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMXD4lrkJ2LfwypuAsGF9fNeAi8I4vO+Am2AH3/IHz4eIiIoA91ikeF4qfLFKECBBn1VIjRt4uGdhDK4LqVirkM='
        user: crowdwish
        owner: crowdwish
        group: crowdwish


git::clone:
    crowdwish_client:
        user: crowdwish
        group: crowdwish
        url: git@git.kdigital.net:crowdwish/client.git
        path: /home/crowdwish/public_html/client/
        depth: 1

    crowdwish_backend:
        user: crowdwish
        group: crowdwish
        url: git@git.kdigital.net:crowdwish/backend.git
        path: /home/crowdwish/public_html/backend/
        depth: 1


apache::module:
    php5: {}


apache::vhost:
    crowdwish_client:
        server_name: crowdwish.dev
        document_root: /home/crowdwish/public_html/client/
        directory:
            /home/crowdwish/public_html/backend/web/public/:
                options: all
                allow_override: all
                require: all granted


    crowdwish_backend:
        server_name: api.crowdwish.dev
        document_root: /home/crowdwish/public_html/backend/web/public/

php::module:
    apc:
        package_prefix: php
    curl: {}
    intl: {}
    pgsql: {}



postgresql::user:
    crowdwish:
        username: crowdwish
        superuser: false
        createdb: true
        createrole: false


composer::install:
    crowdwish:
        require:
            - Php::module[curl]
        path: /home/crowdwish/public_html/backend/web
        user: crowdwish
        group: crowdwish
